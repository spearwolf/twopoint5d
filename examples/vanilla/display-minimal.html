<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script type="importmap">
      {
        "imports": {
          "three": "/examples/vanilla/libs/three/build/three.module.js",
          "@spearwolf/eventize": "/examples/vanilla/libs/eventize.js",
          "twopoint5d": "/packages/twopoint5d/twopoint5d.js"
        }
      }
    </script>
  </head>
  <body>
    <canvas id="twopoint5d" resize-to="window"></canvas>

    <script type="module">
      import { Color, Sprite, SpriteMaterial, TextureLoader } from "three";
      import {
        TextureFactory,
        Stage2D,
        ParallaxProjection,
        Display,
      } from "twopoint5d";

      window.display = new Display(document.getElementById("twopoint5d"));

      const WIDTH = 100;
      const HEIGHT = 100;

      window.stage2d = new Stage2D(
        new ParallaxProjection("xy|bottom-left", {
          width: WIDTH,
          height: HEIGHT,
          fit: "contain",
        })
      );

      const textureFactory = new TextureFactory(display.renderer, [
        "nearest",
        "flipy",
      ]);

      const textureImage = textureFactory.load(
        "/examples/assets/ball-pattern-rot--not-power-of-2.png"
      );

      const material = new SpriteMaterial({ map: textureImage });
      const sprite = new Sprite(material);

      sprite.scale.set(WIDTH, HEIGHT, 1);
      stage2d.scene.add(sprite);

      display.on("init", ({ renderer }) => {
        renderer.setClearColor(new Color("#39323c"), 1.0);
      });

      display.on("resize", ({ width, height }) => {
        stage2d.resize(width, height);
      });

      display.on("frame", ({ renderer }) => {
        stage2d.renderFrame(renderer);
      });

      display.start();

      console.log("display=", display);
      console.log("stage=", stage2d);
    </script>
  </body>
</html>
