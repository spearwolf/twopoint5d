/*!
@file rainbow-line - A custom element that displays a cut line animated with rainbow colors
@author Wolfger Schramm <wolfger@spearwolf.de>
@version 0.4.0+vanilla.20241212

Copyright 2024 Wolfger Schramm

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

*/
var o=class c extends HTMLElement{static InitialHTML=`
    <style>
      :host {
        display: block;
        width: 320px;
        height: 240px;
      }
      .frame {
        position: relative;
        height: 100%;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
    <div class="frame">
      <canvas></canvas>
    </div>
  `;#t=0;#e=0;#i=0;constructor(t=c.InitialHTML){super(),this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=t,this.worker=void 0}queryCanvasElement(){return this.shadow.querySelector("canvas")}createWorker(){throw new Error("createWorker() must be implemented by subclass")}getContextAttributes(){return this.hasAttribute("no-alpha")?{alpha:!1}:{alpha:!0}}#r(){let t=this.canvas.getBoundingClientRect();return this.#t=t.width,this.#e=t.height,{width:t.width,height:t.height}}#n(t){let e=this.canvas.getBoundingClientRect();(this.#t!==e.width||this.#e!==e.height)&&(this.#t=e.width,this.#e=e.height,t(e.width,e.height))}#a=()=>{this.#n((t,e)=>{this.worker.postMessage({resize:{width:t,height:e}})}),this.#s()};#s(){this.#i=requestAnimationFrame(this.#a)}#l(){cancelAnimationFrame(this.#i)}#h(){this.canvas=this.queryCanvasElement();let t=this.canvas.transferControlToOffscreen();this.worker=this.createWorker(),this.worker.postMessage({canvas:t,contextAttributes:this.getContextAttributes(),...this.getInitialWorkerAttributes()},[t])}getInitialWorkerAttributes(){return{}}asNumberValue(t,e){if(this.hasAttribute(t)){let s=parseFloat(this.getAttribute(t));return isNaN(s)?e:s}return e}connectedCallback(){this.worker||this.#h(),this.worker.postMessage({isConnected:!0,resize:this.#r()}),this.#s()}disconnectedCallback(){this.worker.postMessage({isConnected:!1}),this.#l()}};var u=i=>i==="left"?1:-1,d=i=>typeof i=="string"&&i.trim()||void 0,r=class extends o{static observedAttributes=["color-slice-width","slice-cycle-time","cycle-direction","cycle-colors"];constructor(){super(`
      <style>
        :host {
          display: block;
          width: 100%;
          height: 3px;
        }
        .rainbow {
          position: relative;
          height: 100%;
          background: linear-gradient(in hsl longer hue 45deg, #f00 0 0);
        }
        canvas {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
      </style>
      <div class="rainbow">
        <canvas></canvas>
      </div>`)}createWorker(){return new Worker(new URL("rainbow-line.worker.js",import.meta.url),{type:"module"})}getContextAttributes(){return{alpha:!1}}getInitialWorkerAttributes(){return{"color-slice-width":this.asNumberValue("color-slice-width",10),"slice-cycle-time":this.asNumberValue("slice-cycle-time",7),"cycle-direction":u(this.getAttribute("cycle-direction")||"right"),"cycle-colors":this.hasAttribute("cycle-colors")?d(this.getAttribute("cycle-colors")):void 0,"cycle-colors-repeat":this.asNumberValue("cycle-colors-repeat",1)}}attributeChangedCallback(t,e,s){if(!this.worker)return;if(t==="cycle-colors"){this.worker.postMessage({"cycle-colors":d(s)});return}let n=t==="cycle-direction"?u(s):parseFloat(s);typeof n=="number"&&(isNaN(n)||this.worker.postMessage({[t]:n}))}};function a(i){let t=new Blob([i],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);return URL.revokeObjectURL(e),s}function l(){return a(`var pe=Object.defineProperty;var Bt=e=>{throw TypeError(e)};var ge=(e,t,i)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var o=(e,t,i)=>ge(e,typeof t!="symbol"?t+"":t,i),zt=(e,t,i)=>t.has(e)||Bt("Cannot "+i);var s=(e,t,i)=>(zt(e,t,"read from private field"),i?i.call(e):t.get(e)),h=(e,t,i)=>t.has(e)?Bt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),l=(e,t,i,r)=>(zt(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),it=(e,t,i)=>(zt(e,t,"access private method"),i);var Ut=(e,t,i,r)=>({set _(n){l(e,t,n,i)},get _(){return s(e,t,r)}});var P="*",Kt=1,Ft=2,Tt=4,F=Symbol.for("eventize"),ve="[eventize]",yt=e=>e===P,Jt=e=>{switch(typeof e){case"string":case"symbol":return!0;default:return!1}},Xt=typeof console!="undefined",Ee=Xt?console[console.warn?"warn":"log"].bind(console,ve):()=>{},Se=(e,t,i)=>(Object.defineProperty(e,t,{value:i,configurable:!0}),e),Ce=0,Zt=class{constructor(){o(this,"events",new Map);o(this,"eventNames",new Set)}static publish(e){e.sort((t,i)=>t.order-i.order).forEach(t=>t.emit())}add(e){Array.isArray(e)?e.forEach(t=>this.eventNames.add(t)):this.eventNames.add(e)}remove(e){Array.isArray(e)?e.forEach(t=>this.eventNames.delete(t)):this.eventNames.delete(e),this.clear(e)}clear(e){Array.isArray(e)?e.forEach(t=>this.events.delete(t)):this.events.delete(e)}retain(e,t){this.eventNames.has(e)&&this.events.set(e,{args:t,order:Ce++})}isKnown(e){return this.eventNames.has(e)}emit(e,t,i=[]){if(yt(e))this.eventNames.forEach(r=>this.emit(r,t,i));else if(this.events.has(e)){let{order:r,args:n}=this.events.get(e);i.push({order:r,emit:()=>t.apply(e,n)})}return i}},It=(e,t,i,r)=>{if(typeof t=="function"){let n=t.apply(e,i);n!=null&&(r==null||r(n))}},Ae=(e,t,i,r)=>It(t,t.emit,[e].concat(i),r),we=e=>{switch(typeof e){case"function":return Kt;case"string":case"symbol":return Ft;case"object":return Tt}},xe=0,be=()=>++xe,_t=class{constructor(e,t,i,r=null){o(this,"id");o(this,"eventName");o(this,"isCatchEmAll");o(this,"priority");o(this,"listener");o(this,"listenerObject");o(this,"listenerType");o(this,"callAfterApply");o(this,"isRemoved");o(this,"refCount");this.id=be(),this.eventName=e,this.isCatchEmAll=yt(e),this.listener=i,this.listenerObject=r,this.priority=t,this.listenerType=we(i),this.callAfterApply=void 0,this.isRemoved=!1,this.refCount=1}isEqual(e,t=null){if(e===this)return!0;let i=typeof e;return i==="number"&&e===this.id?!0:t===null&&(i==="string"||i==="symbol")?e===P||e===this.eventName:this.listener===e&&this.listenerObject===t}apply(e,t,i){if(this.isRemoved)return;let{listener:r,listenerObject:n}=this;switch(this.listenerType){case Kt:It(n,r,t,i),this.callAfterApply&&this.callAfterApply();break;case Ft:It(n,n[r],t,i),this.callAfterApply&&this.callAfterApply();break;case Tt:{let c=r[e];if(this.isCatchEmAll||this.eventName===e){if(typeof c=="function"){let a=c.apply(r,t);a!=null&&(i==null||i(a))}else Ae(e,r,t,i);this.callAfterApply&&this.callAfterApply()}break}}}},Le=(e,t)=>e.priority!==t.priority?t.priority-e.priority:e.id-t.id,qt=e=>e==null?void 0:e.slice(0),Ht=(e,t)=>{let i=e.indexOf(t);i>-1&&e.splice(i,1)},Re=e=>e===Tt||e===Ft,Dt=(e,t,i)=>{let r=e.findIndex(n=>n.isEqual(t,i));r>-1&&(e[r].isRemoved=!0,e.splice(r,1))},mt=(e,t,i)=>{let r=[];for(let n of e)(t==null&&n.listenerObject===i||n.eventName===t&&n.listener===i)&&r.push(n);for(let n of r)Dt(e,n,void 0)},Ot=e=>{e&&(e.forEach(t=>{t.isRemoved=!0}),e.length=0)},ze=(e,t)=>e.listenerType===t.listenerType?e.priority===t.priority&&e.eventName===t.eventName&&e.listenerObject===t.listenerObject&&e.listener===t.listener:!1,Oe=(e,t)=>{if(Re(e.listenerType))return t.find(i=>ze(e,i))},Ie=(e,t)=>{let i=Oe(e,t);return i?(i.refCount+=1,i):(t.push(e),t.sort(Le),e)},De=class{constructor(){o(this,"namedListeners");o(this,"catchEmAllListeners");o(this,"getListenersForEventName",e=>{let t=this.namedListeners.get(e);return t||(t=[],this.namedListeners.set(e,t)),t});this.namedListeners=new Map,this.catchEmAllListeners=[]}add(e){return Ie(e,e.isCatchEmAll?this.catchEmAllListeners:this.getListenersForEventName(e.eventName))}remove(e,t,i=!1){t==null&&Array.isArray(e)?e.forEach(r=>this.remove(r,null,i)):e==null||t==null&&yt(e)?this.removeAllListeners():t==null&&Jt(e)?Ot(this.namedListeners.get(e)):e instanceof _t?e.isRemoved||(e.refCount-=1,e.refCount<1&&(e.isRemoved=!0,this.namedListeners.forEach(r=>Ht(r,e)),Ht(this.catchEmAllListeners,e))):i?yt(e)?mt(this.catchEmAllListeners,P,e):this.namedListeners.forEach(r=>mt(r,e,t)):(this.namedListeners.forEach(r=>{Dt(r,e,t),mt(r,void 0,e)}),Dt(this.catchEmAllListeners,e,t),mt(this.catchEmAllListeners,void 0,e))}removeAllListeners(){this.namedListeners.forEach(e=>Ot(e)),this.namedListeners.clear(),Ot(this.catchEmAllListeners)}forEach(e,t){let i=qt(this.catchEmAllListeners),r=qt(this.namedListeners.get(e));if(e===P||!r||r.length===0)i.forEach(t);else if(i.length===0)r.forEach(t);else{let n=r.length,c=i.length,a=0,f=0;for(;a<n||f<c;){if(a<n){let u=r[a];if(f>=c||u.priority>=i[f].priority){t(u),++a;continue}}f<c&&(t(i[f]),++f)}}}getSubscriptionCount(){let e=this.catchEmAllListeners.length;for(let t of this.namedListeners.values())e+=t.length;return e}},H=e=>!!(e&&e[F]);function rt(e){if(H(e))return e;let t=new De,i=new Zt;return Se(e,F,{keeper:i,store:t}),e}var Fe={Max:Number.POSITIVE_INFINITY,AAA:1e9,BB:1e6,C:1e3,Default:0,Low:-1e4,Min:Number.NEGATIVE_INFINITY},Te=(e,t,i,r,n,c,a)=>{let f=e.add(new _t(i,r,n,c));return t.emit(i,f,a),f},Me=(e,t,i,r)=>{let n=i.length,c=typeof i[0],a,f,u,I;if(n>=2&&n<=3&&c==="number"?(a=P,[f,u,I]=i):n>=3&&n<=4&&typeof i[1]=="number"?[a,f,u,I]=i:(f=Fe.Default,c==="string"||c==="symbol"||Array.isArray(i[0])?[a,u,I]=i:(a=P,[u,I]=i)),!u&&Xt)throw Ee("called with insufficient arguments!",i),"subscribeTo() called with insufficient arguments!";let et=D=>ye=>Te(e,t,ye,D,u,I,r);return Array.isArray(a)?a.map(D=>Array.isArray(D)?et(D[1])(D[0]):et(f)(D)):et(f)(a)},jt=(e,t,i)=>{let r=[],n=Me(e,t,i,r);return Zt.publish(r),n},Yt=e=>t=>{t.callAfterApply=()=>{e==null||e()}},Vt=(e,t)=>Object.assign(()=>L(e,t),Array.isArray(t)?{listeners:t}:{listener:t}),te=(e,t,i,r)=>{let{store:n,keeper:c}=e[F];Array.isArray(t)?t.forEach(a=>{n.forEach(a,f=>f.apply(a,i,r)),c.retain(a,i)}):t!==P&&(n.forEach(t,a=>{a.apply(t,i,r)}),c.retain(t,i))},Y=(e,...t)=>{let i=rt(e),{store:r,keeper:n}=i[F];return Vt(i,jt(r,n,t))},K=(e,...t)=>{let i=rt(e),{store:r,keeper:n}=i[F],c=jt(r,n,t),a=Vt(i,c),f=!1,u=()=>{f||(a(),f=!0)};return Array.isArray(c)?c.forEach(Yt(u)):Yt(u)(c),u},$e=(e,t)=>new Promise(i=>{K(e,t,i)}),L=(e,t,i)=>{if(!H(e))throw new Error("object is not eventized");let{store:r,keeper:n}=e[F],c=typeof t,a=i!=null&&(c==="string"||c==="symbol");r.remove(t,i,a),Array.isArray(t)?n.remove(t.filter(f=>typeof f=="string")):Jt(t)&&n.remove(t)},d=(e,t,...i)=>{if(!H(e))throw new Error("object is not eventized");te(e,t,i)},Ne=(e,t,...i)=>{if(!H(e))throw new Error("object is not eventized");let r=[];return te(e,t,i,n=>{r.push(n)}),r=r.map(n=>Array.isArray(n)?Promise.all(n):Promise.resolve(n)),r.length>0?Promise.all(r):Promise.resolve()},Mt=(e,t)=>{let i=rt(e),{keeper:r}=i[F];r.add(t)},ke=(e,t)=>{if(!H(e))throw new Error("object is not eventized");let{keeper:i}=e[F];i.clear(t)},R=(()=>{let e=(t={})=>rt(t);return e.inject=(t={})=>(t=rt(t),Object.assign(t,{on:(...i)=>Y(t,...i),once:(...i)=>K(t,...i),onceAsync:i=>$e(t,i),off:(i,r)=>L(t,i,r),emit:(i,...r)=>d(t,i,...r),emitAsync:(i,...r)=>Ne(t,i,...r),retain:i=>Mt(t,i),retainClear:i=>ke(t,i)}),t),e.is=H,e})();var J=R(),st=R(),T=R();var nt,M=class{constructor(){h(this,nt,new Set)}batch(t){s(this,nt).add(t)}run(){d(T,Array.from(s(this,nt)))}};nt=new WeakMap,o(M,"current");var ee=()=>M.current;function $t(e){let t=M.current;t?t=void 0:t=M.current=new M;try{e()}finally{t&&(M.current=void 0,t.run())}}var Ge=0;function Nt(){return Ge>0}var g=Symbol.for("signal"),W=Symbol.for("effect"),kt=Symbol.for("destroySignal"),Gt=Symbol.for("createEffect"),ie=Symbol.for("destroyEffect");var re="destroy";var $=new Map,E,N,v,S,C,B,k,m,A,ot=class ot{constructor(t){h(this,E,new Set);h(this,N,new Set);h(this,v,new Map);h(this,S,new WeakMap);h(this,C,new Map);h(this,B,new Set);h(this,k,new Set);h(this,m,!1);h(this,A);if(t!=null&&t instanceof ot&&!s(t,m))return t;if(t!=null||(t=this),$.has(t))return $.get(t);$.set(t,this),R(this)}static get(t){if(t!=null)return t instanceof ot&&!s(t,m)?t:$.get(t)}static findOrCreate(t){if(t==null)throw new Error("Cannot create a group with a null object");return new ot(t)}static destroy(t){var i;(i=$.get(t))==null||i.destroy()}static clear(){for(let t of $.values())t.destroy();$.clear()}attachGroup(t){if(s(this,m))throw new Error("Cannot attach a group to a destroyed group");if(t===this)throw new Error("Cannot attach a group to itself");return s(this,E).add(t),s(t,A)&&s(t,A)!==this&&s(s(t,A),E).delete(t),l(t,A,this),t}detachGroup(t){if(s(this,m))throw new Error("Cannot detach a group from a destroyed group");return t!==this&&s(this,E).has(t)&&(s(this,E).delete(t),l(t,A,void 0)),t}attachSignal(t){if(s(this,m))throw new Error("Cannot attach a signal to a destroyed group");let i=p(t);if(i!=null&&i.destroyed)throw new Error("Cannot attach a destroyed signal to a group");return i&&s(this,N).add(i),t}attachSignalByName(t,i){if(s(this,m))throw new Error("Cannot attach a named signal to a destroyed group");if(i){this.attachSignal(i);let r=p(i);s(this,v).set(t,r),s(this,C).has(t)?s(this,C).get(t).push(r):s(this,C).set(t,[r]),s(this,S).has(r)?s(this,S).get(r).add(t):s(this,S).set(r,new Set([t]))}else s(this,v).delete(t);return i}hasSignal(t){var i;return s(this,v).has(t)||((i=s(this,A))==null?void 0:i.hasSignal(t))}signal(t){var i,r,n;if(!s(this,m))return(n=(i=s(this,v).get(t))==null?void 0:i.object)!=null?n:(r=s(this,A))==null?void 0:r.signal(t)}detachSignal(t){if(s(this,m))return t;let i=p(t);if(i&&(s(this,N).delete(i),s(this,S).has(i))){let r=s(this,S).get(i);for(let n of r)if(s(this,C).has(n)){let c=s(this,C).get(n);c.splice(c.indexOf(i),1),c.length===0?(s(this,v).delete(n),s(this,C).delete(n)):s(this,v).get(n)===i&&s(this,v).set(n,c.at(-1))}r.clear(),s(this,S).delete(i)}return t}attachEffect(t){if(s(this,m))throw new Error("Cannot attach an effect to a destroyed group");return s(this,B).add(t),t}runEffects(){if(s(this,m))throw new Error("Cannot run effects on a destroyed group");for(let t of s(this,B))t.run();for(let t of s(this,E))t.runEffects()}attachLink(t){if(s(this,m))throw new Error("Cannot attach a link to a destroyed group");if(t!=null&&t.isDestroyed)throw new Error("Cannot attach a destroyed link to a group");return t&&s(this,k).add(t),t}detachLink(t){return s(this,m)||t&&s(this,k).delete(t),t}destroy(){var t;if(!s(this,m)){d(this,re,this),L(this);for(let i of s(this,E))i.destroy();for(let i of s(this,B))i.destroy();for(let i of s(this,N))at(i);for(let i of s(this,k))i.destroy();s(this,E).clear(),s(this,N).clear(),s(this,v).clear(),s(this,C).clear(),s(this,B).clear(),s(this,k).clear(),(t=s(this,A))==null||t.detachGroup(this),$.delete(this),l(this,m,!0),l(this,E,void 0),l(this,N,void 0),l(this,S,void 0),l(this,v,void 0),l(this,C,void 0),l(this,S,void 0),l(this,k,void 0),Object.freeze(this)}}};E=new WeakMap,N=new WeakMap,v=new WeakMap,S=new WeakMap,C=new WeakMap,B=new WeakMap,k=new WeakMap,m=new WeakMap,A=new WeakMap;var X=ot;var se;se=W;var pt=class{constructor(t){o(this,se);o(this,"run",()=>{var t;return(t=this[W])==null?void 0:t.run()});o(this,"destroy",()=>{var t;(t=this[W])==null||t.destroy(),this[W]=void 0});this[W]=t,K(t,Z.Destroy,()=>{this[W]=void 0})}};var ct,ft,_=class{constructor(t="id",i=1){h(this,ct);h(this,ft);l(this,ct,t),l(this,ft,i)}make(){return Symbol(\`\${s(this,ct)}\${Ut(this,ft)._++}\`)}};ct=new WeakMap,ft=new WeakMap;var Qt=[],gt=()=>Qt.at(-1),ne=(e,t)=>{Qt.push(e);try{return t()}finally{Qt.pop()}};var Qe=e=>e!=null&&typeof e.then=="function",G,Q,U,q,j,w=class w{constructor(t,i){o(this,"id");o(this,"callback");h(this,G);h(this,Q,new Set);h(this,U,new Set);o(this,"parentEffect");o(this,"childEffects",[]);o(this,"curChildEffectSlot",0);o(this,"autorun",!0);o(this,"shouldRun",!0);h(this,q);h(this,j,!1);o(this,"run",()=>{if(s(this,j)||!this.shouldRun)return;let t=ee();t?t.batch(this.id):(this.runCleanupCallback(),this.curChildEffectSlot=0,this.shouldRun=!1,this.hasStaticDeps()?l(this,G,this.callback()):l(this,G,ne(this,this.callback)))});o(this,"destroy",()=>{s(this,j)||(d(this,w.Destroy,this),L(this),d(T,ie,this),this.runCleanupCallback(),L(J,this),L(T,this),L(st,this),l(this,j,!0),s(this,Q).clear(),s(this,U).clear(),this.childEffects.forEach(t=>{t.destroy()}),this.childEffects.length=0,--w.count)});var n;R(this),this.callback=t;let r;(i==null?void 0:i.attach)!=null&&(r=X.findOrCreate(i.attach),r.attachEffect(this)),this.autorun=(n=i==null?void 0:i.autorun)!=null?n:!0,l(this,q,i!=null&&i.dependencies?i.dependencies.map(c=>{switch(typeof c){case"string":case"symbol":return r.signal(c);default:return c}}):void 0),this.id=w.idGen.make(),Y(T,this.id,"recall",this),++w.count}hasStaticDeps(){return s(this,q)!=null&&s(this,q).length>0}saveSignalsFromDeps(){for(let t of s(this,q))this.whenSignalIsRead(p(t).id)}static createEffect(t,i,r){let n=Array.isArray(i)?i:void 0,c=n?r!=null?r:{dependencies:n}:i;c&&n&&(c.dependencies=n);let a,f=gt();return f!=null?(a=f.getCurrentChildEffect(),a==null&&(a=new w(t,c),f.attachChildEffect(a),d(T,Gt,a)),f.curChildEffectSlot++):(a=new w(t,c),d(T,Gt,a)),a.hasStaticDeps()?a.saveSignalsFromDeps():a.autorun&&a.run(),new pt(a)}getCurrentChildEffect(){return this.childEffects[this.curChildEffectSlot]}attachChildEffect(t){this.childEffects.push(t),this.parentEffect=this}recall(){this.shouldRun=!0,this.autorun&&this.run()}whenSignalIsRead(t){s(this,Q).has(t)||(s(this,Q).add(t),Y(J,t,"recall",this),K(st,t,kt,this))}[kt](t){!s(this,U).has(t)&&s(this,Q).has(t)&&(s(this,U).add(t),L(J,t,this),s(this,U).size===s(this,Q).size&&this.destroy())}runCleanupCallback(){if(s(this,G)!=null){let t=s(this,G);l(this,G,void 0),Qe(t)?Promise.resolve(t).then(i=>{typeof i=="function"&&i()}):t()}}};G=new WeakMap,Q=new WeakMap,U=new WeakMap,q=new WeakMap,j=new WeakMap,o(w,"idGen",new _("ef")),o(w,"Destroy","destroy"),o(w,"count",0);var Z=w;var z=(...e)=>Z.createEffect(...e);var Pe=new WeakMap;var vt=(e,t)=>{var i,r;return(r=(i=Pe.get(e))==null?void 0:i.signals)==null?void 0:r.get(t)};function oe(e){let t=p(V(e)?e:vt(...e));t!=null&&!t.muted&&!t.destroyed&&Et(t.id,t.value,{touch:!0})}function ae(e){var t,i;return V(e)?(t=p(e))==null?void 0:t.value:(i=p(vt(...e)))==null?void 0:i.value}var ce;ce=g;var St=class{constructor(t){o(this,ce);this[g]=t}get get(){return this[g].reader}get set(){return this[g].writer}get value(){return ae(this.get)}set value(t){this.set(t)}onChange(t){let{destroy:i}=z(()=>t(this.value),[this.get]);return i}get muted(){return this[g].muted}set muted(t){this[g].muted=t}touch(){oe(this)}destroy(){at(this)}};var We=new _("si");function fe(e){var t;Nt()||(t=gt())==null||t.whenSignalIsRead(e)}function Et(e,t,i){Nt()||d(J,e,t,i)}var V=e=>e!=null&&e[g]!=null,Be=e=>{let t=i=>{var r;return i?z(()=>(e.destroyed||fe(e.id),i(e.value)),[t]):e.destroyed||((r=e.beforeRead)==null||r.call(e),fe(e.id)),e.value};return Object.defineProperty(t,g,{value:e}),t},x,At=class At{constructor(t,i){o(this,"id");o(this,"lazy");o(this,"compare");o(this,"beforeRead");o(this,"muted",!1);o(this,"destroyed",!1);h(this,x);o(this,"valueFn");o(this,"reader");o(this,"writer",(t,i)=>{var f,u,I;let r=(f=i==null?void 0:i.lazy)!=null?f:!1,n=(u=i==null?void 0:i.compare)!=null?u:this.compare,c=n!=null?n:(et,D)=>et===D;if((r!==this.lazy||r&&t!==this.valueFn||!r&&!c(t,s(this,x)))&&(r?(l(this,x,void 0),this.valueFn=t,this.lazy=!0):(l(this,x,t),this.valueFn=void 0,this.lazy=!1),!this.muted&&!this.destroyed)){Et(this.id,s(this,x));return}((I=i==null?void 0:i.touch)!=null?I:!1)&&Et(this.id,s(this,x),{touch:!0})});o(this,"object");this.id=We.make(),++At.instanceCount,this.lazy=t,this.lazy?(this.value=void 0,this.valueFn=i):(this.value=i,this.valueFn=void 0),this.reader=Be(this),this.object=new St(this)}get[g](){return this}get value(){return this.lazy&&(l(this,x,this.valueFn()),this.valueFn=void 0,this.lazy=!1),s(this,x)}set value(t){l(this,x,t)}};x=new WeakMap,o(At,"instanceCount",0);var Ct=At,p=e=>e==null?void 0:e[g];function tt(e=void 0,t){var r;let i;if(V(e))i=p(e);else{let n=(r=t==null?void 0:t.lazy)!=null?r:!1;i=new Ct(n,e),i.beforeRead=t==null?void 0:t.beforeRead,i.compare=t==null?void 0:t.compare}return(t==null?void 0:t.attach)!=null&&X.findOrCreate(t.attach).attachSignal(i),i.object}var at=(...e)=>{for(let t of e){let i=p(t);i!=null&&!i.destroyed&&(i.destroyed=!0,i.beforeRead=void 0,--Ct.instanceCount,d(st,i.id,i.id))}};var y,lt,ht,O,Pt,he,ue,le=(y=class{constructor(){h(this,O);h(this,lt,0);h(this,ht);R(this);let t=tt(null),i=tt(!1),r=tt(0),n=tt(0);Object.defineProperties(this,{canvas:{get:t.get,set:t.set,enumerable:!0},isConnected:{get:i.get,set:i.set,enumerable:!0},canvasWidth:{get:r.get,set:r.set,enumerable:!0},canvasHeight:{get:n.get,set:n.set,enumerable:!0}}),this.now=0,Mt(this,[y.Canvas,y.Init,y.Resize]),z(()=>{this.canvas&&d(this,y.Canvas,this,s(this,ht))},[t]),z(()=>{this.ready&&d(this,y.Init,this)},[t,i]),z(()=>{d(this,y.Resize,this)},[r,n])}get ready(){return this.canvas&&this.isConnected}parseMessageData(t){t&&(t.canvas&&(l(this,ht,t.contextAttributes||void 0),this.canvas=t.canvas),t.isConnected&&this.isConnected!==t.isConnected&&(this.isConnected=t.isConnected,this.isConnected?it(this,O,Pt).call(this):it(this,O,he).call(this)),t.resize&&this.canvas&&(this.canvas.width=Math.floor(t.resize.width),this.canvas.height=Math.floor(t.resize.height)))}},lt=new WeakMap,ht=new WeakMap,O=new WeakSet,Pt=function(){l(this,lt,requestAnimationFrame(t=>it(this,O,ue).call(this,t)))},he=function(){cancelAnimationFrame(s(this,lt))},ue=function(t){this.ready&&($t(()=>{this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height}),this.now=t/1e3,this.canvasWidth>0&&this.canvasHeight>0&&d(this,y.Frame,this)),it(this,O,Pt).call(this)},o(y,"Canvas","onCanvas"),o(y,"Init","onInit"),o(y,"Resize","onResize"),o(y,"Frame","onFrame"),y);var de=new le,xt=10,ut=7,Wt=-1,bt,Lt=1,dt=null,Ue=1024,b=null,wt=null,Rt=null;Y(de,{onCanvas({canvas:e},t){dt=e.getContext("2d",t)},onFrame({now:e,canvasWidth:t,canvasHeight:i}){let r=xt<1?Math.round(xt*t):xt,n=0;for(;n<t;){let c=n/t;if(bt===void 0){let a=e%ut*Wt*360/ut;dt.fillStyle=\`hsl(\${c*360+a}, 100%, 50%)\`}else{let a=Lt<1?t/(Lt*t):Lt,f=e%ut*Wt/ut,u=(c+f)*a%1;u<0&&(u+=1),dt.fillStyle=qe(u)}dt.fillRect(n,0,r,i),n+=r}}});function me(e){if(de.parseMessageData(e),"color-slice-width"in e&&(xt=e["color-slice-width"]),"slice-cycle-time"in e&&(ut=e["slice-cycle-time"]),"cycle-direction"in e&&(Wt=e["cycle-direction"]),"cycle-colors"in e){let t=e["cycle-colors"];t===void 0?bt=void 0:(bt=[...t.toLowerCase().matchAll(/(#[a-f0-9]+|[a-z]+\\([^)]+\\)|[a-z]+([^(]|$))( |$)+/g)].map(i=>i[0].trim()),He(bt))}"cycle-colors-repeat"in e&&(Lt=e["cycle-colors-repeat"])}function qe(e){let t=Math.max(Math.min(Math.floor(e*b.width),b.width-1),0)*4,i=Rt.data[t],r=Rt.data[t+1],n=Rt.data[t+2];return\`rgb(\${i},\${r},\${n})\`}function He(e){b==null&&(b=new OffscreenCanvas(Ue,1),wt=b.getContext("2d"));let t=dt.createLinearGradient(0,0,b.width,b.height),i=0,r=1/e.length;for(let n=0;n<e.length;n++)t.addColorStop(i,e[n]),i+=r;t.addColorStop(1,e[0]),wt.fillStyle=t,wt.fillRect(0,0,b.width,b.height),Rt=wt.getImageData(0,0,b.width,b.height)}self.addEventListener("message",e=>{me(e.data)});
/*! Bundled license information:

@spearwolf/eventize/lib/index.mjs:
  (*!
  =============================================================================
  @spearwolf/eventize 4.0.1+build.20240804
  \u2014 https://github.com/spearwolf/eventize.git
  =============================================================================
  
  Copyright 2015-2024 Wolfger Schramm
  
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
     http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  *)
*/
`)}var h=class extends r{createWorker(){return l()}};customElements.define("rainbow-line",h);
