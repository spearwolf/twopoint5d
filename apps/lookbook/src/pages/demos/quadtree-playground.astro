---
import Layout from '~layouts/VanillaDemo.astro';
import {title} from './quadtree-playground.json';
---

<Layout title={title}>
  <canvas id="twopoint5d" resize-to="window"></canvas>
</Layout>

<style>
  :global(.lil-gui) :global(option) {
    color: #555;
  }
</style>

<script>
  import {Display, DisplayEventArgs} from '@spearwolf/twopoint5d';
  import GUI from 'lil-gui';
  import {QuadTreeVisualization} from '~shared/quadtree-playground/QuadTreeVisualization';

  // -----------------------------

  const settings = {
    width: 256,
    height: 256,
    fit: 'contain',
  };

  // -----------------------------

  const display = new Display(document.getElementById('twopoint5d')!);

  const visual = new QuadTreeVisualization(display.renderer, settings.width, settings.height);

  visual.canvasStage.on('resize', () => {
    visual.render();
  });

  display.on({
    resize: ({width, height}: DisplayEventArgs) => {
      visual.canvasStage.setContainerSize(width, height);
    },

    frame: () => {
      visual.canvasStage.render();
    },
  });

  display.start();

  // -----------------------------

  function updateViewSize() {
    visual.canvasStage.setCanvasSize(settings.width, settings.height);
  }

  // -----------------------------

  const gui = new GUI({title: 'quadtree playground'});

  gui.add(settings, 'width').onChange(updateViewSize);
  gui.add(settings, 'height').onChange(updateViewSize);
  gui.add(settings, 'fit', ['contain', 'cover']).onChange(() => {
    visual.canvasStage.fit = settings.fit as any;
  });
</script>
